SelectWithUnionQuery (children 1)
 ExpressionList (children 1)
  SelectQuery (children 3)
   ExpressionList (children 2)
    Subquery (alias withA) (children 1)
     SelectWithUnionQuery (children 1)
      ExpressionList (children 1)
       SelectQuery (children 2)
        ExpressionList (children 1)
         Function countDistinct (children 1)
          ExpressionList (children 1)
           Identifier colU
        TablesInSelectQuery (children 1)
         TablesInSelectQueryElement (children 1)
          TableExpression (children 1)
           TableIdentifier tabA
    Subquery (alias withB) (children 1)
     SelectWithUnionQuery (children 1)
      ExpressionList (children 1)
       SelectQuery (children 2)
        ExpressionList (children 1)
         Function countDistinct (children 1)
          ExpressionList (children 1)
           Identifier colU
        TablesInSelectQuery (children 1)
         TablesInSelectQueryElement (children 1)
          TableExpression (children 1)
           TableIdentifier tabA
   ExpressionList (children 1)
    Function divide (alias ratio) (children 1)
     ExpressionList (children 2)
      Identifier withA
      Identifier withB
   TablesInSelectQuery (children 1)
    TablesInSelectQueryElement (children 1)
     TableExpression (children 1)
      Subquery (alias main) (children 1)
       SelectWithUnionQuery (children 1)
        ExpressionList (children 1)
         SelectQuery (children 3)
          ExpressionList (children 2)
           Identifier date (alias period)
           Identifier colX
          TablesInSelectQuery (children 1)
           TablesInSelectQueryElement (children 1)
            TableExpression (children 1)
             Subquery (alias tempB) (children 1)
              SelectWithUnionQuery (children 1)
               ExpressionList (children 1)
                SelectQuery (children 2)
                 ExpressionList (children 2)
                  Identifier date
                  Function if (alias colX) (children 1)
                   ExpressionList (children 3)
                    Function in (children 1)
                     ExpressionList (children 2)
                      Identifier colA
                      Subquery (children 1)
                       SelectWithUnionQuery (children 1)
                        ExpressionList (children 1)
                         SelectQuery (children 2)
                          ExpressionList (children 1)
                           Identifier colB
                          TablesInSelectQuery (children 1)
                           TablesInSelectQueryElement (children 1)
                            TableExpression (children 1)
                             TableIdentifier tabC
                    Literal UInt64_0
                    Identifier colA
                 TablesInSelectQuery (children 1)
                  TablesInSelectQueryElement (children 1)
                   TableExpression (children 1)
                    TableIdentifier tabB
          ExpressionList (children 2)
           Identifier period
           Identifier colX
The query succeeded but the server error '60' was expected (query: EXPLAIN AST WITH (SELECT count(distinct colU) from tabA) AS withA, (SELECT count(distinct colU) from tabA) AS withB SELECT withA / withB AS ratio FROM (SELECT date AS period, colX FROM (SELECT date, if(colA IN (SELECT colB FROM tabC), 0, colA) AS colX FROM tabB) AS tempB GROUP BY period, colX) AS main; -- {serverError UNKNOWN_TABLE}).
